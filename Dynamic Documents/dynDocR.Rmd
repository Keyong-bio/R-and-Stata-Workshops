---
title: "Creating a Dynamic Document via R MarkDown"
author: "Desmond D. Wallace"
date: "April 27, 2018"
output: html_document
---

# Introduction

In this workshop, I will demonstrate how to create a dynamic document in R. These documents are useful for integrating statistical code with narration that explains the executed code. By either clicking a button or typing a command, one can execute the code in an R Markdown file, reproducing one's work and exporting the results in a finished report. One can export a finished report in a variety of formats, including HTML, PDF, Microsoft Word, or rich text format documents; as well as HTML- or PDF-based slides, Notebooks, and more. I will demonstrate how to export the finished document as an HTML web page, a Word document, and a PDF document (requires LaTeX installation).

# Basic Example

The following example is included as part of an .Rmd file template.

## What is R Markdown?

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

# Preliminary Steps

## Step #1: Set Working Directory

Before one begins any research project, they should always set their working directory. One can set the working directory in R via the `setwd(dir)` function.

```{r wd, eval=FALSE}
setwd(dir = "filepath")
```

Note that the `eval = FALSE` parameter was added to the code chunk to prevent execution of the R code specified in the R code chunk.

One of the nice features of a R markdown document is that when *kniting* this file, the working directory is set automatically to the location of the markdown file, thus making this step unnecessary.

## Step #2: Load Required Packages

The second step is loading any required packages. Here, I use a user-created function to check if my R installation includes the set of specified packages. If it does not, then R will install the package(s) along with any associated dependent packages. Below is the function in question.

```{r packageFunc}
ipak <- function(pkg){
        new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
        if (length(new.pkg))
                install.packages(new.pkg, dependencies = TRUE)
        sapply(pkg, require, character.only = TRUE)
}
```

The code chunk below places the names of the packages I am planning to use in a character vector-type object. I then use this object as the parameter for the package-loading function.

```{r packageLoad, echo=FALSE, message=FALSE, results='hide', warning=FALSE}
packages <- c("tidyverse",
              "rio",
              "margins",
              "stargazer",
              "texreg")

ipak(packages)
```

If you do not see anything, it is because I specified the following parameters: `echo=FALSE`, `message=FALSE`, `results='hide'`, and `warning=FALSE`. The parameter `message=FALSE` prevents any messages generated from the code from appearing in the document. The parameter `results='hide'` prevents any output produced from the code to appear in the document. Finally, the parameter `warning=FALSE` prevents any warnings generated from the code from appearing in the document.

# Basic Tables

## Summary Tables

To create a table reporting summary statistics, I recommend using the `stargazer` package.

```{r tab1}
stargazer(attitude,
          type = "html",
          title = "Summary Statistics")
```

Notice that executing the code chunk above yielded the printing of raw HTML code, which should produce a pretty table. To correct this, I will include the parameter `results='asis'`, which will pass through results without reformatting them.

```{r tab1Correct, echo=FALSE, results='asis'}
stargazer(attitude,
          type = "html", # Change to "larex" for pdf file
          title = "Summary Statistics")
```

Because the `stargazer` function produces raw HTML code, including the parameter `results='asis'` passes the raw HTML code to the final document, where everything is in HTML code. The statistics reported in the summary table are observation count, mean, standard deviation, minimum, and maximum. For example, the mean of the variable `rating` is `r mean(attitude$rating)`. To report the mean for `rating`, I used inline code, represented as a single backtick, followed by the letter `r`, then the R code in question, and finished with another single backtick. Inline code automatically reports the result, never the actual code.

If I want to report the results of a regression model, or multiple regression models, I prefer to use the `texreg` package. What makes `texreg` different from `stargazer` is that `texreg` allows the user more flexibility regarding custom model implementation. Below is an example of creating a table featuring results from three models: two OLS models and a probit model.

```{r tab2Setup, results='hide'}
##  2 OLS models
linear.1 <- lm(rating ~ complaints + privileges + learning + raises + critical,
               data = attitude)
linear.2 <- lm(rating ~ complaints + privileges + learning,
               data = attitude)
## create an indicator dependent variable, and run a probit model
attitude$high.rating <- (attitude$rating > 70)
probit.model <- glm(high.rating ~ learning + critical + advance,
                    data = attitude,
                    family = binomial(link = "probit"))
```

```{r tab2, results='asis'}
htmlreg(l = list(linear.1,
                 linear.2,
                 probit.model),
        caption = "Results",
        caption.above = TRUE)
```

